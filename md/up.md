# 远程控制工具 更新日志



# V2.2.9 (2025-08-20)

**GitHub Actions 版本更新功能测试**

## 🧪 测试目的
- **同版本重复构建测试**：验证 GitHub Actions 在构建相同版本时的更新日志合并功能
- **自动化工作流验证**：确保 CI/CD 流程在各种场景下的稳定性和可靠性
- **版本管理系统测试**：测试版本检测、历史日志提取和内容合并的完整流程

## 🔍 新增功能验证
- **版本重复检测机制**：
  - 自动识别同标签的重复构建请求
  - 智能区分新版本发布与重新构建场景
- **历史内容保留策略**：
  - 从现有 Release 中提取之前的更新内容
  - 保持版本历史的完整性和连续性
- **智能日志合并**：
  - 本次构建更新与历史更新内容的有机结合
  - 提供清晰的版本变更时间线

## 📊 测试范围
- **工作流触发测试**：验证标签推送和手动触发的准确性
- **构建环境测试**：确认 Windows + Python 3.12.10 环境的稳定性
- **文件生成测试**：验证所有可执行文件的正确生成和打包
- **发布流程测试**：确认 Release 创建、资产上传和说明生成的完整性

## 🎯 预期结果
- GitHub Actions 能够正确识别版本状态并相应调整更新日志策略
- 重复版本构建时保留完整的历史信息而不是简单覆盖
- 为用户提供清晰、完整的版本变更历史和构建信息

---

**注：此版本主要用于测试 GitHub Actions 的版本更新功能，确保自动化构建流程的稳定性。**



# V2.2.8 (2025-08-20)

**GitHub Actions 集成与 CI/CD 自动化**

## 🚀 CI/CD 自动化
- **GitHub Actions 工作流**：
  - 新增完整的构建与发布自动化流程（`build-and-release.yml`）
  - 支持标签触发自动构建：推送如 `V2.2.8` 标签时自动编译并发布对应版本
  - 手动触发支持：可通过 GitHub 界面手动触发工作流进行测试
  - Windows 环境：使用 `windows-latest` 运行器，Python 3.12.10
- **双打包系统集成**：
  - PyInstaller（主要）+ Nuitka（备用）双重打包保障
  - 智能版本提取：自动从标签 `V2.2.8` 提取版本号 `2.2.8`
  - 统一输出目录：`installer/dist/` 中生成所有可执行文件

## 📋 自动更新日志生成
- **智能变更记录**：
  - 基于 Git 提交历史自动生成结构化更新日志
  - 自动检测上一个标签进行版本对比
  - 包含详细的构建信息、环境参数和下载链接
- **多层次内容**：
  - 版本信息与构建时间戳
  - 构建环境详情（Python 版本、构建 ID、运行器等）
  - 文件列表与功能说明
  - 安装指导和系统要求
  - 提交变更详细列表

## 📖 文档体系完善
- **工作流文档**（`.github/workflows/README.md`）：
  - 详细的使用指南和测试说明
  - 标签创建示例和手动触发教程
  - 故障排查和常见问题解答
- **更新日志生成指南**（`.github/CHANGELOG_GENERATION.md`）：
  - 基础到高级的多种更新日志生成方案
  - 第三方集成选项（release-changelog-builder-action 等）
  - AI 增强和自定义模板配置指导

## 🔧 项目优化
- **文件组织**：
  - 优化 `.gitignore` 配置，排除构建产物和临时文件
  - 统一更新日志存储位置（`md/up.md`）
- **版本管理**：
  - 增强程序运行检查和强制关闭功能
  - 确保安装和卸载过程的程序安全性

## 🎯 开发体验提升
- **自动化流程**：
  - 从代码提交到版本发布的完全自动化
  - 减少手动操作，提升发布效率和一致性
  - 支持预览测试，降低发布风险
- **标准化输出**：
  - 统一的发布格式和文件命名规范
  - 自动生成的 GitHub Releases 和资产上传

---

# V2.2.7 (2025-08-19)

**构建系统优化与备用打包支持**

## 构建与打包
- **双打包系统**：
  - PyInstaller（推荐）：稳定可靠，托盘图标正常显示
  - Nuitka（备用）：体积更小，但托盘图标可能不显示
- **Nuitka 集成**：
  - 完整构建流程，输出目录与 PyInstaller 一致
  - 中间文件：`installer/build-nuitka/`，最终 EXE：`installer/dist/`
  - 添加 `--follow-imports` 解决依赖导入问题

## 资源文件更新
- 更新托盘彩蛋图片扩展名：cd3.png → cd3.jpg，cd4.png → cd4.jpg
- 同步更新所有构建脚本和文档引用

## 功能优化
- **检查更新**：托盘菜单实时显示更新状态，后台异步检查
- **安装器优化**：
  - 修复运行中程序导致安装失败的问题
  - 安装前自动检测并提示关闭运行中的程序
  - 静默安装时直接强制关闭，交互安装时用户确认
- **卸载器优化**：
  - 新增交互界面，支持选择保留配置文件
  - 修复运行中程序导致卸载失败的问题
  - 自动强制终止所有程序进程（包括管理员权限进程）
  - 智能清理计划任务和注册表项

## 文档更新
- README.md 重构打包说明，新增手动打包教程和对比表格
- 添加常见问题解答（FAQ），说明 Nuitka 已知问题

---

# V2.2.6 (2025-08-18)

合并 2.2.4、2.2.5 变更统一发布（不包含 2.2.3，已单独发布）。

**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.2.3...V2.2.6

## 构建与打包
- 统一所有 PyInstaller 构建产物至 `installer/` 目录：
  - EXE 输出：`installer/dist/RC-*.exe`
  - 工作目录：`installer/build/`
  - 安装包：`installer/dist/installer/Remote-Controls-Installer-<version>.exe`
- `installer/build_installer.ps1` 适配新的输出路径；移除根目录 `build.bat`，新增根目录 `build.ps1` 作为双击入口，内部转发到 `installer/build_installer.ps1`，路径健壮并规避 cmd 编码问题。
- 三个 `.spec` 文件集中到 `installer/`，以相对路径引用源码与资源。

## 版本信息与打包联动
- 新增并统一版本信息文件 `version_info.py`，集中管理版本与应用元数据。
- 新增 `installer/update_version.py`：
  - 根据输入版本自动生成/覆盖 `version_info.py`；
  - 生成简版 `version.txt` 供安装器读取；
  - 防御性处理：如仍存在硬编码 `BANBEN="Vx.y.z"`，会同步为当前版本，避免显示不一致。
- `GUI.py`、`main.py`、`tray.py` 通过 `version_info.get_version_string()` 显示版本（保留回退值以防缺文件时崩溃）。
- `installer/build_installer.bat` 集成版本更新：构建前输入版本后，自动更新 `version_info.py` 与 Inno 宏 `#define MyAppVersion`，三款 EXE 与安装包版本一键对齐。

## 安装器（Inno Setup 6）
- 脚本英文化与重建，路径与版本宏对齐：
  - `OutputDir=dist\installer`（相对 `installer/`）
  - 安装文件源自 `dist\RC-*.exe`（相对 `installer/`）
- 计划任务创建/删除逻辑与 GUI 完全一致：
  - 主程序：系统启动触发（Boot），以 SYSTEM，RunLevel=Highest，ExecutionTimeLimit=PT0S。
  - 托盘：用户登录触发（Logon），当前用户，RunLevel=Highest。
- 卸载：可选保留 `config.json`（默认保留），日志目录始终删除。
- 任务默认勾选策略调整：
  - 各任务项 Flags 均设为 `unchecked`；
  - 在“选择附加任务”页面进入时通过 `CurPageChanged` 代码默认勾选全部，用户仍可取消；
  - 如需页面默认保持不勾选，可移除该代码块，即呈现“全部未选”。
- 编译提示：以管理员模式安装同时写入 HKCU 时，Inno 会提示 UsedUserAreasWarning，为预期行为。

## GUI
- 计划任务名称切换为英文以匹配安装器：
  - 主任务：`Remote Controls Main Service`
  - 托盘任务：`Remote Controls Tray`
- 修复设置开机自启动相关问题：
  - 移除错误的 Pascal 片段与不合法运算符；采用 Windows 友好的路径包裹方式；
  - 兼容清理旧版中文任务名（若存在）；
  - 修复一处字符串未闭合问题。
- 自定义主题：修复保存后“最后一项重复”的问题，生成配置前清理旧派生键，重建树视图确保索引正确。

## 托盘（Tray）
- 版本菜单（仅 EXE 模式）显示“更新状态”：
  - 发现新版本 x.y.z / 已是最新 / 检查失败（GitHub Releases，短超时，失败不阻塞）。
  - 点击行为不变：打开项目主页。
- 清理菜单文案：不再显示【脚本模式】/【EXE模式】前缀。

## 文档
- 更新并同步构建产物路径与双击脚本使用说明。

## 其它
- 无新增第三方依赖；更新检查基于标准库（urllib/json/re），网络不可用时提示“检查失败”。
- 若开启测试模式可清空日志，便于排查。


# V2.2.3 (2025-08-17)

**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.2.2...V2.2.3

## 托盘
- 版本菜单在 EXE 模式下会显示“更新状态”：
  - 发现新版本 x.y.z / 已是最新 / 检查失败（GitHub Releases 自动检查，短超时，失败不阻塞）。
  - 点击行为保持不变：仍打开项目主页。
- 移除“运行模式”菜单文案，不再显示【脚本模式】/【EXE模式】前缀。

## GUI
- 修复自定义主题“保存后最后一项重复”的问题：
  - 在生成配置前清理旧的自定义主题派生键（applicationN/serveN/commandN/hotkeyN 及其后缀），
    避免多次保存导致读取时按序累积重复。
  - 不影响其它配置键；仍使用重建树视图确保索引正确。

## 其它
- 无新增第三方依赖；更新检查使用标准库（urllib/json/re），网络不可用时显示“检查失败”。


# V2.2.2 (2025-08-16)

（合并原 2.2.1 变更一起发布，未单独发布 2.2.1）

**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.2.0...V2.2.2

## 热键(Hotkey)
- 新增“字母段间隔(ms)”可配置项（最小 ≈25ms）：
  - 无“+”时的整串输入与含“+”时的字母段，逐字符之间按该间隔发送。
  - GUI 在“按键(Hotkey)”设置中提供输入框，配置将持久化到 config，并被主程序执行时生效。
- 录制与解析规则优化：
  - 无“+”时按字符序列依次输入；含“+”时，字母段按顺序展开，功能键按原键（F1..F24、Tab、Enter、Esc…）。
  - 支持 {down}/{up} 和 _down/_up 控制任意键的按下/抬起。
  - 录制时按键顺序不再排序，允许重复；中文输入法时忽略非 ASCII，避免录入中文字符。
  - 保存时若检测到中文/全角字符，弹出确认提示以避免误保存。

## 自定义主题窗口与测试
- 添加/修改自定义主题窗口默认尺寸增加，提升可视区域。
- 按类型动态切换操作按钮：
  - 程序或脚本：按钮为“选择文件”，写入“值”文本框。
  - 服务(需管理员权限)：按钮为“打开服务”，直接打开 services.msc。
  - 命令：按钮为“PowerShell测试”，在新的 PowerShell 窗口中展示当前命令并提示按回车后执行（-NoExit/NoProfile/Bypass；使用新控制台窗口，不影响本程序界面）。

## 通知
- 新增“通知提示”全局开关：
  - GUI 中可开启/关闭，写入配置；主程序在发送 toast 前检查该开关，关闭时仅记录日志不推送。

## 托盘 & 打包
- 托盘图标单击：默认打开配置界面（与“打开配置界面”菜单一致）。
- 托盘菜单：
  - 版本菜单：点击打开项目主页。
  - 托盘状态：点击随机打开 res 下彩蛋图片（cd1~cd5）。
- GUI 图标：窗口与任务栏图标统一为 `res/top.ico`（移除旧的 top.png 依赖）。
- 打包修订：
  - GUI 打包需包含 `res/icon_GUI.ico` 与 `res/top.ico`。
  - 托盘可选打包彩蛋图，注意 cd1、cd2 为 `.jpg` 扩展名（其余示例为 `.png`）。

## 文档
- README 与更新日志同步上述变更：托盘行为说明、打包命令示例与注意事项。


# V2.2.0 (2025-08-15)

**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.1.6...V2.2.0
（注：V2.1.7 未单独发布，相关变更合并至本版本）

## 新功能
- 按键(Hotkey)：支持自定义键盘组合（Ctrl/Alt/Shift/Win + 键），可为主题配置 on/off 两种动作；加载逻辑兼容旧版设置。
- 命令主题：新增“命令”自定义主题类型，可执行命令（支持显示窗口开关、PowerShell/CMD 隐藏执行）、注册与中断；中断通过控制台 CTRL_BREAK 信号实现。

## 命令执行与中断
- 统一通过 PowerShell 启动命令，新增“显示窗口”复选框；支持 PowerShell/CMD 隐藏窗口执行。
- 命令类型完善：支持命令的注册与中断，通过控制台发送 CTRL_BREAK 信号中断进程。
- 中断优化：仅针对同主题最新存活的 PID 发送中断，避免误伤旧进程。

## 睡眠/电源管理
- 新增启用/关闭睡眠与状态检查入口，并在执行前加入风险/离线提示。
- 优化详情窗口布局与展示高度，提升信息可读性。

## GUI/UX
- 自定义主题窗口支持大小调整并改进布局；详情信息更清晰。
- 启用高 DPI 感知与统一字体，显著提升高分屏下的渲染清晰度与可读性。

## 配置与稳定性
- 启动时增加配置文件检查；测试模式可清空日志，便于排查。
- 更新内置/自定义主题的说明文档内容。


# V2.1.6 最新发行版 (2025-08-09)

**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.1.5...V2.1.6

## 内置主题配置增强
- GUI新增“更多”设置，合并计算机/睡眠主题配置，支持开/关动作与延迟
- 主程序同步读取并执行，支持延时与显示器电源控制

## 配置与优化
- 由generate_config统一保存并持久化新键
- 去除重复动作（计算机主题不再包含睡眠/休眠）


# V2.1.5

**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.1.4...V2.1.5
## 修复部分特殊应用程序启动异常的问题

更新process_command函数，添加工作目录设置及使用ShellExecuteW模拟双击以修复部分程序启动异常


# V2.1.4 (2025-07-14)

**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.1.3...V2.1.4

## 注：旧版本升级需要重新配置客户端ID（私钥）选项

### 🚀 MQTT认证系统重构
- **多平台IoT支持**: 新增对巴法云、阿里云IoT、腾讯云IoT、AWS IoT、华为云IoT、自定义mqtt服务器等多平台的兼容支持
- **双认证模式**: 
  - 私钥模式：适用于巴法云等平台，客户端ID作为私钥进行认证，无需账号密码
  - 账号密码模式：兼容大多数标准IoT平台，使用用户名/密码认证
- **认证模式GUI选择**: 在配置界面新增认证模式下拉选择，支持中文显示
<img width="450" height="320" alt="PixPin_2025-07-14_01-57-37" src="https://github.com/user-attachments/assets/f0653973-cebd-4255-abdf-8449fa542219" />

### 🔧 配置管理优化
- **变量统一**: 合并`client_id`和`secret_id`变量，删除冗余配置项
- **GUI界面简化**: 
  - 删除密钥输入框，统一使用客户端ID字段
  - 私钥模式下客户端ID显示为密码格式（`*`）保护隐私
  - 优化认证配置布局和说明文字

### 🛡️ 错误处理增强
- **MQTT连接错误处理**: 
  - 新增`ConnectionRefusedError`异常捕获（错误代码10061）
  - 认证失败时停止无意义重试，显示详细错误信息
  - 自动识别"Not authorized"错误并提供解决建议
- **配置验证**: 私钥模式下检查客户端ID是否为空，提供明确警告
- **用户友好提示**: 所有错误都提供具体原因分析和解决方案

### 📚 文档完善
- **新增MQTT认证指南**: 创建`MQTT_AUTH_GUIDE_V2.md`，详细说明多平台配置方法
- **配置示例**: 提供`example_config_simplified.json`简化配置示例
- **平台兼容性说明**: 详细列出支持的IoT平台和配置方法

### 🔒 安全性提升
- **私钥保护**: 私钥模式下客户端ID输入框使用密码遮盖显示
- **认证信息验证**: 连接前验证必需的认证参数是否完整
- **错误信息安全**: 日志中隐藏敏感的密码信息

### 🎯 用户体验改进
- **智能错误识别**: 根据不同错误类型提供针对性解决方案
- **自动配置引导**: 错误时自动打开配置界面引导用户修正
- **清晰的状态反馈**: 改进连接状态和错误提示的用户界面


## V2.1.3 (2025-07-11)

### 🐛 Bug修复
- **修复GUI自定义主题索引错误**: 修复自定义主题列表中双击第三个主题会打开第四个主题的索引错位问题
- **优化主题管理逻辑**: 新增`rebuild_custom_theme_tree()`函数，确保树视图索引与数组索引保持一致
- **完善主题操作流程**: 修复添加、修改、删除主题后的索引更新问题

### 🔧 功能改进
- **增强GUI稳定性**: 所有自定义主题操作现在都会正确更新索引，避免操作错误对象

## V2.1.2 (2025-07-11)

### 🔧 核心修复
- **修复批处理脚本启动失败**: 改用`cmd /c`方式启动，解决路径和特殊字符问题

### 🚀 多脚本支持
- **PowerShell脚本(.ps1)**: 使用`powershell.exe -ExecutionPolicy Bypass -File`自动启动
- **Python脚本(.py/.pyw)**: 使用`python.exe`自动启动
- **媒体控制**: 新增播放/暂停、切换曲目功能（窗帘设备类型）

### 🎯 进程管理升级
- **精确脚本进程终止**: 避免误杀用户进程，支持wmic、psutil、taskkill多重终止策略
- **专用终止函数**: 针对批处理和PowerShell脚本的增强版终止方法
- **命令行精确匹配**: 通过参数匹配确保只终止目标脚本进程

### � 文档和环境
- **依赖版本更新**: 基于Python 3.12.10实际测试环境验证
- **README完善**: 新增脚本支持说明和环境配置指导

## V2.1.1 (2025-07-10)

### 🐛 Bug修复
- **修复主题类型选择错误**: 修复了GUI中主题类型选择的拼写错误，确保服务类型能够正确显示

### ⚡ 性能优化
- **管理员权限优化**: 优化程序的管理员权限请求逻辑，增加UAC提权功能，确保用户在需要时能够以管理员权限运行程序
- **开机自启动优化**: 
  - 改进开机自启动设置，增加用户选择启动方案的功能
  - 支持用户登录或系统启动时运行的选择
  - 改进用户选择方案的提示，增加取消选择的处理
  - 确保托盘程序的启动设置更为稳健

### 🔧 功能改进
- **配置文件处理**: 优化配置文件读取逻辑，增加错误处理和用户交互，支持备份和删除错误配置文件
- **日志记录优化**: 
  - 优化日志记录功能
  - 增加命令执行和服务状态的日志信息
  - 改进进程查找信息记录

### 📝 其他更新
- 更新程序版本号至V2.1.1
- 统一各模块的版本信息显示
