<!-- @format -->

# CHANGELOG

This file mirrors the detailed changelog in `md/up.md`.

---

# V2.3.6 (2025-10-04)

**Hotkey 输入兼容性修复与内部健壮性补丁**

## 🐛 问题修复
- **修复** 自定义 Hotkey 中配置值包含 `Enter` / `enter` / `RETURN` 时被拆分为字母 `e n t e r` 逐个发送的问题；现统一识别为一次回车键。
- **修复** `enter` 作为组合键末尾时被当作普通字符输入导致无法触发预期快捷操作的异常行为。

## 🔧 行为与实现优化
- **优化** Hotkey 解析逻辑：新增 `special_single_keys` 防止功能键（enter/esc/tab/space 等）被错误按字符拆分。
- **兼容** 功能键大小写与同义：`Enter` / `enter` / `RETURN` / `return` 均映射为统一 `enter`。
- **安全** 逻辑仅在快捷键触发路径生效，不影响应用/命令/服务主题的其他处理流程。

## ✅ 回归与影响评估
- 不影响已有配置文件结构；无需修改现有 `config.json`。
- 已验证：普通字母串（如 `abc`）仍按字符序列依次发送；组合键（如 `ctrl+alt+s`）行为不变。
- 建议用户如之前为规避问题临时改写了回车相关配置，可恢复为直写 `Enter`。

## 📌 升级建议
属于小版本快速修复，推荐所有使用自定义回车快捷键的用户更新。

---

# V2.3.5 (2025-09-27)

**CrashSender错误处理与开机自启稳定性增强**

## 🛡️ CrashSender错误专项处理
- **新增** 智能CrashSender错误检测与忽略机制：新增 `@safe_crash_handler` 装饰器，自动识别并安全忽略所有CrashSender相关错误
- **新增** 多级错误检测算法：支持检测 `crashsender`、`crash sender`、`crash-sender` 等多种错误变体
- **新增** 函数级异常保护：为所有托盘菜单相关函数添加异常处理装饰器

## ⚡ 开机自启稳定性增强
- **新增** 启动时间检测机制：智能识别开机自启场景（启动后60秒内）
- **新增** 开机自启延迟保护：检测到开机自启时，主程序初始化延迟5秒执行
- **新增** 点击事件节流保护：开机后30秒内，托盘菜单点击操作添加0.5秒延迟

## 🔧 程序稳定性优化
- **新增** 托盘图标运行时专门错误处理：增强 `icon.run()` 的异常捕获
- **新增** 详细的错误上下文日志：记录异常发生的函数名称、错误类型、完整堆栈信息
- **新增** 带返回结果的启动函数：优化主程序启动流程，确保启动状态可追踪
- **新增** 延迟通知机制：主程序完全启动后才发送通知，避免启动过程中的通知显示问题
- **优化** 用户通知机制：CrashSender错误显示为警告通知而非错误通知

## 🐛 主要问题修复
- **修复** 开机自启后点击"托盘状态"触发"Error launching CrashSender.exe"错误导致托盘进程终止的问题
- **修复** 系统启动初期资源紧张时的程序崩溃问题
- **修复** 外部crash报告机制触发的异常未捕获问题

## ✅ 用户影响
- **零配置**：完全向后兼容，无需修改任何用户配置
- **零学习成本**：所有错误处理在后台自动进行
- **建议更新**：强烈推荐更新到此版本，获得更稳定的开机自启体验

---

# V2.3.4 (2025-09-15)

**弱网/兼容性修复与启动稳定性改进**

## 🔧 关键修复
- 修复在无网络或 DNS 解析失败时程序直接退出的问题：连接流程改为异步 `connect_async` + 后台循环 `loop_start()`，并增加自动重连退避（2s-30s），弱网场景下程序将持续重试并以替换式通知提示状态，网络恢复后自动清除提示。
- 修复 paho-mqtt 回调签名兼容性问题：调整 `on_disconnect` 回调为 v2 签名以避免运行时参数错误导致崩溃。
- 修复客户端 ID 类型问题：确保传入 `Client._client_id` 的为 `bytes`（对字符串进行 UTF-8 编码），避免库内部重复 `.decode()` 导致异常。
- 增强消息处理健壮性：`on_message` 现在兼容 `bytes` 与 `str` payload，解码使用 `utf-8` 并容错，单条消息异常不会导致主进程退出。

## 🛡 影响范围
- 主程序（`RC-main`）启动与网络稳定性相关逻辑被加固；托盘与 GUI 行为保持不变。
- 仅修复兼容性/健壮性问题，无新增功能或行为改变。

## ✅ 建议验证步骤
- 正常网络启动：程序应常驻并自动订阅主题，通知中心仅短暂显示“正在连接…”并在成功后自动清除。
- 无网络启动：程序不应退出，会显示替换式“正在重试”通知；恢复网络后提示自动消失并继续正常工作。

---


# V2.3.2 (2025-09-03)

**稳定性加固与打包精简**  
**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.3.1...V2.3.2

## 🛡 稳定性 / 崩溃防护
- 新增全局 `sys.excepthook` 安全捕获：记录未捕获异常并以通知提示，避免 PyInstaller 某些环境弹出 *CrashSender.exe* 报错窗口导致托盘闪退。
- 托盘“托盘状态”动作改为异步线程 + ShellExecuteW 打开浏览器，降低同步调用造成的阻塞和偶发崩溃概率（线程内多层 try/except 防御）。
- 增加 1 秒节流，防止用户快速连点触发多重浏览器启动造成资源竞争。

## 🌐 浏览器调用逻辑调整
- 统一使用 `ShellExecuteW('open', url)` 优先方案，失败再回退 `webbrowser.open`，提升与默认浏览器/多浏览器管理器兼容性。
- 移除窗口句柄/模拟 F5 刷新方案，避免聚焦/刷新错误标签页的副作用（忽略“刷新同标签”改为明确新开或直接聚焦交由浏览器处理）。

## 🧹 打包脚本与资源
- PyInstaller / Nuitka 打包脚本移除对本地彩蛋图片 (cd1~cd5) 的收集与捆绑逻辑，减小构建体积 & 降低差异变更导致的打包失败风险。
- `tray.py` 头部打包说明同步：当前仅需 `icon.ico`。

## 🔔 通知与可用性
- “随机图片”动作统一通知文案：失败/过快/成功三态明确区分，替换式通知避免刷屏。

## 🛠 代码健壮性
- 网络 / 打开浏览器链路分段捕获异常，确保失败不会传播到主消息循环。
- 去除无用的本地回退路径与冗余扫描逻辑，减少 I/O。

## 📦 影响范围
- 主程序及 GUI 行为未改动（与 2.3.1 保持一致）。
- 仅托盘与打包脚本发生差异；更新后无需额外迁移或清理操作。

> 注：本次版本按要求忽略“彩蛋”相关历史改动，不计入变更点。


# V2.3.1 (2025-08-29)

**托盘交互与通知系统实时性强化**  
**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.3.0...V2.3.1

## 🛎 通知系统重构（低延迟）
- 自定义应用名称：主程序与托盘分别显示为“远程控制主程序 / 托盘”，不再是默认 Python。
- 新增图标自适应：自动生成 64×64 透明留白缩放 PNG，避免系统裁剪导致图标被放大截断。

