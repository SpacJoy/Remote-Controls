<!-- @format -->

# CHANGELOG

This file mirrors the detailed changelog in `md/up.md`.

---

# V2.3.4 (2025-09-15)

**弱网/兼容性修复与启动稳定性改进**

## 🔧 关键修复
- 修复在无网络或 DNS 解析失败时程序直接退出的问题：连接流程改为异步 `connect_async` + 后台循环 `loop_start()`，并增加自动重连退避（2s-30s），弱网场景下程序将持续重试并以替换式通知提示状态，网络恢复后自动清除提示。
- 修复 paho-mqtt 回调签名兼容性问题：调整 `on_disconnect` 回调为 v2 签名以避免运行时参数错误导致崩溃。
- 修复客户端 ID 类型问题：确保传入 `Client._client_id` 的为 `bytes`（对字符串进行 UTF-8 编码），避免库内部重复 `.decode()` 导致异常。
- 增强消息处理健壮性：`on_message` 现在兼容 `bytes` 与 `str` payload，解码使用 `utf-8` 并容错，单条消息异常不会导致主进程退出。

## 🛡 影响范围
- 主程序（`RC-main`）启动与网络稳定性相关逻辑被加固；托盘与 GUI 行为保持不变。
- 仅修复兼容性/健壮性问题，无新增功能或行为改变。

## ✅ 建议验证步骤
- 正常网络启动：程序应常驻并自动订阅主题，通知中心仅短暂显示“正在连接…”并在成功后自动清除。
- 无网络启动：程序不应退出，会显示替换式“正在重试”通知；恢复网络后提示自动消失并继续正常工作。

---


# V2.3.2 (2025-09-03)

**稳定性加固与打包精简**  
**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.3.1...V2.3.2

## 🛡 稳定性 / 崩溃防护
- 新增全局 `sys.excepthook` 安全捕获：记录未捕获异常并以通知提示，避免 PyInstaller 某些环境弹出 *CrashSender.exe* 报错窗口导致托盘闪退。
- 托盘“托盘状态”动作改为异步线程 + ShellExecuteW 打开浏览器，降低同步调用造成的阻塞和偶发崩溃概率（线程内多层 try/except 防御）。
- 增加 1 秒节流，防止用户快速连点触发多重浏览器启动造成资源竞争。

## 🌐 浏览器调用逻辑调整
- 统一使用 `ShellExecuteW('open', url)` 优先方案，失败再回退 `webbrowser.open`，提升与默认浏览器/多浏览器管理器兼容性。
- 移除窗口句柄/模拟 F5 刷新方案，避免聚焦/刷新错误标签页的副作用（忽略“刷新同标签”改为明确新开或直接聚焦交由浏览器处理）。

## 🧹 打包脚本与资源
- PyInstaller / Nuitka 打包脚本移除对本地彩蛋图片 (cd1~cd5) 的收集与捆绑逻辑，减小构建体积 & 降低差异变更导致的打包失败风险。
- `tray.py` 头部打包说明同步：当前仅需 `icon.ico`。

## 🔔 通知与可用性
- “随机图片”动作统一通知文案：失败/过快/成功三态明确区分，替换式通知避免刷屏。

## 🛠 代码健壮性
- 网络 / 打开浏览器链路分段捕获异常，确保失败不会传播到主消息循环。
- 去除无用的本地回退路径与冗余扫描逻辑，减少 I/O。

## 📦 影响范围
- 主程序及 GUI 行为未改动（与 2.3.1 保持一致）。
- 仅托盘与打包脚本发生差异；更新后无需额外迁移或清理操作。

> 注：本次版本按要求忽略“彩蛋”相关历史改动，不计入变更点。


# V2.3.1 (2025-08-29)

**托盘交互与通知系统实时性强化**  
**Full Changelog**: https://github.com/chen6019/Remote-Controls/compare/V2.3.0...V2.3.1

## 🛎 通知系统重构（低延迟）
- 自定义应用名称：主程序与托盘分别显示为“远程控制主程序 / 托盘”，不再是默认 Python。
- 新增图标自适应：自动生成 64×64 透明留白缩放 PNG，避免系统裁剪导致图标被放大截断。

